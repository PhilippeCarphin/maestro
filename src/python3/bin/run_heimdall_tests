#!/bin/bash

HEIMDALL_ROOT=$(dirname $(dirname $(realpath $0)))

$HEIMDALL_ROOT/bin/assert_python3_is_setup || exit 1

# These scripts can be safely run at any time to repair aspects of the project.
# For example, accidentally re-introducing bad quotatation characters, or forgetting to regenerate documention.
# Out of convenience, these are run whenever tests are run.
$HEIMDALL_ROOT/bin/generate_messages_markdown || (echo "Failed to generate documentation." && exit 1)
$HEIMDALL_ROOT/bin/repair_codes_csv || (echo "Failed to repair codes CSV." && exit 1)

export MAESTRO_PYTHON3_LOGGING_CONFIG=test

$HEIMDALL_ROOT/venv/bin/python3 $HEIMDALL_ROOT/src/run_tests.py --heimdall $@
