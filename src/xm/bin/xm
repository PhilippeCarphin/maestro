#!/bin/ksh

assert_x11_forwarding_is_enabled || exit 1

[[ "$1" = --help || "$1" = -h ]] && set -h

[[ -z ${SEQ_MAESTRO_DOMAIN} ]] && echo "SEQ_MAESTRO_DOMAIN not set, maestro installation incomplete" && exit 1 

if ! [[ -f ${SEQ_TCL_BIN}/maestro_wish8.5 ]] ; then 
    echo "Installation incomplete. tcl/tk bin not found. SEQ_TCL_BIN='${SEQ_TCL_BIN}'" 
    exit 1 
fi 

export PATH=${PATH}:${SEQ_SRC}/tcl/bin
export TCL_LIBRARY=${TCL_LIBRARY}:${SEQ_SRC}/tcl/lib/tcl8.5
export TK_LIBRARY=${TK_LIBRARY}:${SEQ_SRC}/tcl/lib/tk8.5
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$SEQ_TCL_LIB

TCLSH=$(which maestro_wish8.5)

# -- issues with $TMPDIR
if [ ${#TMPDIR} -eq 0 ];then
        echo "The env. variable is not defined ... using /tmp/$(id -nu)/$$ "
	export TMPDIR=/tmp/$(id -nu)/$$
fi

# -- Language
#if [ ${#CMCLNG} -eq 0 ];then
       export CMCLNG=english
#fi

# -- export SEQ_BIN
test "${SEQ_BIN}" == "" && print "\nSEQ_BIN not defined! Exiting...\n" && exit 1

# create default depot if not exist
[ -d $HOME/.suites ] || mkdir $HOME/.suites

# -- VERY first time user --> dont have .maestro.rc file and no Exp's.
#    >>Convention : .maestro.rc file should alwys reside in user HOME<<
#    Note : it could be possible that this user has used the interface
#           before but his .maestro.rc file has been erased for X reason !!

if [ ! -s $HOME/.maestrorc ];then
   # -- have to create one and Populate it with minimum data
   cp ${SEQ_MANAGER_SRC}/etc/config/maestrorc $HOME/.maestrorc
fi

arguments=$*
eval `cclargs $0 "[xm]" \
  -exp          ""      ""      "[experiment path]" \
  ++ $arguments`

$TCLSH ${SEQ_MANAGER_SRC}/lib/x_manager/XPManager.tcl $arguments &
